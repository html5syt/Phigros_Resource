name: Cleanup Old Branches

on:
  workflow_dispatch:
    inputs:
      branches:
        description: "要删除的分支列表(逗号分隔)"
        required: true
        default: "avatar,chart,illustration,illustrationBlur,illustrationLowRes,info,music"

permissions:
  contents: write

jobs:
  cleanup:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Delete old branches
        run: |
          # 设置Git身份
          git config user.name "GitHub Action"
          git config user.email "action@github.com"
          
          # 从输入中获取分支列表
          IFS=',' read -ra BRANCHES <<< "${{ github.event.inputs.branches }}"
          
          # 删除本地和远程分支
          for branch in "${BRANCHES[@]}"; do
            echo "Deleting branch: $branch"
            
            # 删除远程分支
            git push origin --delete "$branch" || true
            
            # 删除本地分支引用
            git branch -D "$branch" || true
          done
          
          echo "Old branches deleted successfully"